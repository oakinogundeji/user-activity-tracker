<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>User Activity Tracker | Telios WebDev</title>
    <!--Normalize-->
    <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css"/>
    <!--Bootstrap CSS-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!--Font Awesome-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!--stylesheets-->
    <link rel="stylesheet" href="css/styles.css">
    <!--jQuery 2.x-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!--Bootstrap JS-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!--custom elem detection script-->
    <script>
        $(function () {
            'use strict';
            // below section detects all the trigger elements on the page
            /*console.log('jQuery existing...');
            function getTriggers() {
                const $triggers = $('.trigger');
                console.log('$triggers...');
                return console.log($triggers);
            }

            function getTriggersH2() {
                const
                    $triggers = $('.trigger'),
                    $H2 = $triggers.children('h2');
                console.log('$H2...');
                console.log($H2);
                $H2.each(function (idx) {
                    const
                        elem = $(this),
                        sectionHeading = elem.text();
                    return console.log(`Elem: ${elem}, text: ${sectionHeading}`);
                });
            }

            if ("onhashchange" in window) {
                console.log("The browser supports the hashchange event!");
                window.addEventListener("hashchange", getTriggersH2, false);
            }
            getTriggersH2();*/
            // below section attaches handlers to all elems in the '.trigger' class

            if(window.localStorage) {
                console.log('local storage supported!!!');
            }

            function detectMouseEnter() {
                const $triggers = $('.trigger');
                let
                    time_lapse,
                    start,
                    end,
                    location;
                $triggers.on('mouseenter', function () {
                    const
                        elem = $(this),
                        $H2 = elem.children('h2');
                    start = Date.now();
                    location = window.location.href;
                    $H2.each(function (idx) {
                        const
                            elem = $(this),
                            sectionHeading = elem.text();
                        return console.log(`Entering - Section: ${sectionHeading} @ Location: ${location}`);
                    });
                });
                $triggers.on('mouseleave', function () {
                    const
                        elem = $(this),
                        $H2 = elem.children('h2');
                    end = Date.now();
                    $H2.each(function (idx) {
                        const
                            elem = $(this),
                            sectionHeading = elem.text();
                        time_lapse = end - start;
                        console.log(`Leaving - Section: ${sectionHeading} @ Location: ${location}, you spent: ${time_lapse} millisecs`);

                        console.log(`trying to retrieve data: ${localStorage.getItem(sectionHeading)}`);
                        const previousData = localStorage.getItem(sectionHeading);
                        if(time_lapse > 4999) {
                            if(previousData) {
                                const
                                    numericPreviousData = Number(previousData),
                                    newData = numericPreviousData + time_lapse;
                                console.log(`numericPreviousData: ${numericPreviousData}`);
                                console.log(`newData: ${newData}`);
                                localStorage.setItem(sectionHeading, newData);
                                return console.log(`successfully updated data: ${localStorage.getItem(sectionHeading)}`);
                            } else {
                                localStorage.setItem(sectionHeading, time_lapse);
                                return console.log(`successfully saved fresh data: ${localStorage.getItem(sectionHeading)}`);
                            }
                        }
                    });
                });
            }

            if ("onhashchange" in window) {
                console.log("The browser supports the hashchange event!");
                window.addEventListener("hashchange", detectMouseEnter, false);
            }
            detectMouseEnter()
        });
        /*function getTriggers() {
            const $triggers = document.getElementsByClassName('trigger');
            console.log('$triggers...');
            return console.log($triggers);
        }

        function getTriggersH2() {
            const $triggers = document.getElementsByClassName('trigger');
            return Array.from($triggers).forEach(element => {
                const H_2 = element.getElementByClassName('h2');
                return console.log(`element ${element}: h2 ${H_2}`);
            });
        }

        window.addEventListener("load", getTriggersH2);

        if ("onhashchange" in window) {
            console.log("The browser supports the hashchange event!");
            window.addEventListener("hashchange", getTriggers, false);
        }*/
    </script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
</head>
<body>
    <main id="app" class="container">
        <app-nav></app-nav>
        <keep-alive>
            <router-view></router-view>
        </keep-alive>
        <app-footer></app-footer>
    </main>
    <script src="js/main.js"></script>
</body>
